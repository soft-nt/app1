---
phase: 08-city-configuration
plan: 03
type: execute
wave: 2
depends_on: ["08-01"]
files_modified:
  - src/components/CitySelector.tsx
  - src/components/CityMap.tsx
  - src/App.css
autonomous: true

must_haves:
  truths:
    - "User sees list of 20+ cities in dropdown"
    - "User can filter cities by typing"
    - "Filtered results update in real-time"
    - "Currently selected city shows visual indicator"
    - "Map displays location of selected city"
  artifacts:
    - path: "src/components/CitySelector.tsx"
      provides: "Searchable city dropdown"
      exports: ["default"]
      min_lines: 50
    - path: "src/components/CityMap.tsx"
      provides: "Static map display"
      exports: ["default"]
      min_lines: 20
  key_links:
    - from: "src/components/CitySelector.tsx"
      to: "src/data/cities.ts"
      via: "import CITIES"
      pattern: "import.*CITIES.*from.*data/cities"
    - from: "src/components/CitySelector.tsx"
      to: "src/types/city.ts"
      via: "import type City"
      pattern: "import.*City.*from.*types/city"
---

<objective>
Create the city selection UI components: searchable city dropdown with real-time filtering and static map display for location visualization.

Purpose: Enable users to find and select cities from the preset list with visual feedback. Map provides geographic context without heavy interactive map libraries.
Output: CitySelector component with search/filter, CityMap component with static map image
</objective>

<execution_context>
@/home/ntorrent/.claude/get-shit-done/workflows/execute-plan.md
@/home/ntorrent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-city-configuration/08-RESEARCH.md

# Plan 01 outputs (must exist before this plan runs)
@src/types/city.ts
@src/data/cities.ts

# Existing patterns
@src/components/Header.tsx
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CitySelector component</name>
  <files>src/components/CitySelector.tsx</files>
  <action>
Create CitySelector component following the filtered list pattern from RESEARCH.md:

Props interface:
- selectedCity: City (currently selected city)
- onSelectCity: (city: City) => void (callback when city selected)

Implementation:
1. Import City type and CITIES array
2. useState for filter text (controlled input)
3. useMemo for filtered cities - filter by name.toLowerCase().includes(filter.toLowerCase())
4. Render:
   - Search input with placeholder "Search cities..."
   - Scrollable list of filtered cities
   - Each city shows: name, country, checkmark if selected (city.id === selectedCity.id)
   - onClick calls onSelectCity(city)

Structure:
```tsx
<div className="city-selector">
  <input
    type="text"
    value={filter}
    onChange={e => setFilter(e.target.value)}
    placeholder="Search cities..."
    className="city-search"
  />
  <ul className="city-list">
    {filteredCities.map(city => (
      <li
        key={city.id}
        onClick={() => onSelectCity(city)}
        className={`city-item ${city.id === selectedCity.id ? 'selected' : ''}`}
      >
        <span className="city-name">{city.name}, {city.country}</span>
        {city.id === selectedCity.id && <span className="city-check">âœ“</span>}
      </li>
    ))}
  </ul>
</div>
```

Use useMemo to avoid recalculating filtered list on every render (per RESEARCH.md anti-patterns).
  </action>
  <verify>Import in test, render with mock selectedCity, verify filter works and selection callback fires</verify>
  <done>CitySelector exported, filters cities in real-time, shows selection indicator</done>
</task>

<task type="auto">
  <name>Task 2: Create CityMap component</name>
  <files>src/components/CityMap.tsx</files>
  <action>
Create CityMap component for static map display:

Props interface:
- city: City (city to display on map)

Implementation:
Use OpenStreetMap static tile approach. Since OSM tiles require specific tile coordinates (not lat/lng directly), use a simpler approach:

Option A (Recommended): Use OpenStreetMap embed iframe
```tsx
const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${lng-0.5}%2C${lat-0.5}%2C${lng+0.5}%2C${lat+0.5}&layer=mapnik&marker=${lat}%2C${lng}`;
```

Option B: Use a free static map API like Geoapify or MapTiler (requires free API key)

For simplicity, use Option A with iframe:
```tsx
function CityMap({ city }: { city: City }) {
  const { latitude: lat, longitude: lng, name } = city;
  const bbox = `${lng - 1},${lat - 1},${lng + 1},${lat + 1}`;
  const mapUrl = `https://www.openstreetmap.org/export/embed.html?bbox=${encodeURIComponent(bbox)}&layer=mapnik&marker=${lat},${lng}`;

  return (
    <div className="city-map">
      <iframe
        src={mapUrl}
        width="100%"
        height="200"
        style={{ border: 'none' }}
        title={`Map of ${name}`}
        loading="lazy"
      />
    </div>
  );
}
```

Include loading="lazy" for performance. Use semantic title for accessibility.
  </action>
  <verify>Render with a test city (Geneva), verify map shows correct location with marker</verify>
  <done>CityMap exported, displays OpenStreetMap embed centered on city with marker</done>
</task>

<task type="auto">
  <name>Task 3: Add city component styles</name>
  <files>src/App.css</files>
  <action>
Add CSS for CitySelector and CityMap to App.css:

1. .city-selector:
   - display: flex
   - flex-direction: column
   - gap: 0.75rem

2. .city-search (input):
   - padding: 0.5rem 0.75rem
   - border: 1px solid #ddd
   - border-radius: 4px
   - font-size: 1rem
   - width: 100%
   - box-sizing: border-box

3. .city-list (ul):
   - list-style: none
   - padding: 0
   - margin: 0
   - max-height: 200px
   - overflow-y: auto
   - border: 1px solid #eee
   - border-radius: 4px

4. .city-item (li):
   - padding: 0.75rem 1rem
   - cursor: pointer
   - display: flex
   - justify-content: space-between
   - align-items: center
   - border-bottom: 1px solid #f0f0f0
   - transition: background-color 0.15s

5. .city-item:hover:
   - background-color: #f5f5f5

6. .city-item.selected:
   - background-color: #e8f4e8
   - font-weight: 500

7. .city-item:last-child:
   - border-bottom: none

8. .city-check:
   - color: #2e7d32
   - font-weight: bold

9. .city-map:
   - margin-top: 1rem
   - border-radius: 8px
   - overflow: hidden

10. .city-map iframe:
    - display: block
  </action>
  <verify>Open components in browser, verify scrollable list, hover states, selection highlight, map container</verify>
  <done>City components styled with consistent design, scrollable list, clear selection indicator</done>
</task>

</tasks>

<verification>
1. CitySelector renders all cities from CITIES array
2. Typing in search input filters list in real-time
3. Selected city shows checkmark and highlighted background
4. Clicking city triggers onSelectCity callback
5. CityMap shows OpenStreetMap with marker at city coordinates
6. Styles match app design language
</verification>

<success_criteria>
- User can search and find cities quickly
- Selection state is clearly visible
- Map provides geographic context for selected city
- No external JavaScript libraries added (uses native APIs + OSM embed)
</success_criteria>

<output>
After completion, create `.planning/phases/08-city-configuration/08-03-SUMMARY.md`
</output>
