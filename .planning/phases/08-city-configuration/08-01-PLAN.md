---
phase: 08-city-configuration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/city.ts
  - src/data/cities.ts
  - src/utils/storage.ts
autonomous: true

must_haves:
  truths:
    - "City type exists with name, latitude, longitude fields"
    - "20+ cities available spanning global timezones"
    - "localStorage operations handle errors gracefully"
  artifacts:
    - path: "src/types/city.ts"
      provides: "City type definition"
      exports: ["City"]
    - path: "src/data/cities.ts"
      provides: "Static city list with coordinates"
      exports: ["CITIES", "DEFAULT_CITY"]
    - path: "src/utils/storage.ts"
      provides: "localStorage wrapper with error handling"
      exports: ["saveCity", "loadCity"]
  key_links:
    - from: "src/data/cities.ts"
      to: "src/types/city.ts"
      via: "import type"
      pattern: "import.*City.*from.*types/city"
---

<objective>
Create the data foundation for city configuration: type definitions, static city list with coordinates, and localStorage persistence utilities.

Purpose: Establish the data layer that all other city configuration features depend on. The city list with hardcoded lat/lng avoids geocoding API calls for known cities.
Output: City type, 20+ city array with coordinates, localStorage wrapper with try-catch error handling
</objective>

<execution_context>
@/home/ntorrent/.claude/get-shit-done/workflows/execute-plan.md
@/home/ntorrent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-city-configuration/08-RESEARCH.md

# Existing types to follow pattern from
@src/types/weather.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create City type definitions</name>
  <files>src/types/city.ts</files>
  <action>
Create City interface with fields:
- id: string (unique identifier, lowercase kebab-case e.g., "new-york")
- name: string (display name e.g., "New York")
- country: string (country name e.g., "United States")
- latitude: number
- longitude: number

Follow the pattern from src/types/weather.ts (interface style, JSDoc comments).
Export the City type as a named export.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>City interface exported from src/types/city.ts with id, name, country, latitude, longitude fields</done>
</task>

<task type="auto">
  <name>Task 2: Create static city list</name>
  <files>src/data/cities.ts</files>
  <action>
Create src/data/ directory if needed. Create cities.ts with:

1. Import City type from ../types/city
2. Export CITIES array with 20+ cities covering:
   - Americas: New York, Los Angeles, Chicago, Toronto, Mexico City, Sao Paulo, Buenos Aires
   - Europe: London, Paris, Berlin, Madrid, Rome, Amsterdam, Geneva (default)
   - Asia: Tokyo, Beijing, Shanghai, Hong Kong, Singapore, Mumbai, Dubai
   - Oceania: Sydney, Melbourne
   - Africa: Cairo, Johannesburg

3. Export DEFAULT_CITY constant pointing to Geneva (id: "geneva")

For each city include accurate lat/lng coordinates (verify with Google Maps or similar).
Example entry:
```typescript
{ id: 'geneva', name: 'Geneva', country: 'Switzerland', latitude: 46.2044, longitude: 6.1432 }
```

Sort cities alphabetically by name for easier scanning.
  </action>
  <verify>Import and log CITIES in a test file, verify 20+ entries with valid coordinates: `node -e "console.log(require('./src/data/cities.ts').CITIES.length)"`</verify>
  <done>CITIES array exported with 20+ cities, DEFAULT_CITY points to Geneva, all entries have valid lat/lng</done>
</task>

<task type="auto">
  <name>Task 3: Create localStorage wrapper</name>
  <files>src/utils/storage.ts</files>
  <action>
Create src/utils/ directory if needed. Create storage.ts with:

1. STORAGE_KEY constant: 'selectedCityId'

2. saveCity(cityId: string): boolean
   - Wrap localStorage.setItem in try-catch
   - Return true on success, false on failure
   - Log warning on QuotaExceededError or SecurityError

3. loadCity(): string | null
   - Wrap localStorage.getItem in try-catch
   - Return stored city ID or null
   - Log warning on SecurityError (private browsing mode)

Follow pattern from RESEARCH.md - always wrap localStorage in try-catch to handle:
- SecurityError (private browsing, disabled storage)
- QuotaExceededError (storage full)

Export both functions as named exports.
  </action>
  <verify>Run in browser console or test: save/load cycle works, returns null when storage empty</verify>
  <done>saveCity and loadCity exported, handle localStorage errors gracefully without crashing</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes (no TypeScript errors)
2. City type has all required fields (id, name, country, latitude, longitude)
3. CITIES array has 20+ entries with valid coordinates
4. DEFAULT_CITY is Geneva
5. localStorage functions handle errors without throwing
</verification>

<success_criteria>
- City type can be imported and used throughout the app
- All cities have accurate coordinates for weather API calls
- localStorage wrapper gracefully handles private browsing and storage errors
- No external dependencies added (uses native APIs only)
</success_criteria>

<output>
After completion, create `.planning/phases/08-city-configuration/08-01-SUMMARY.md`
</output>
