---
phase: 08-city-configuration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/SettingsModal.tsx
  - src/App.css
autonomous: true

must_haves:
  truths:
    - "Modal opens when triggered and closes via X button"
    - "Modal closes when clicking backdrop overlay"
    - "Esc key closes modal"
    - "Modal styling matches app design language"
  artifacts:
    - path: "src/components/SettingsModal.tsx"
      provides: "Modal component using native dialog element"
      exports: ["default"]
      min_lines: 40
    - path: "src/App.css"
      provides: "Modal styling"
      contains: ".settings-modal"
  key_links:
    - from: "src/components/SettingsModal.tsx"
      to: "dialog element"
      via: "useRef + showModal()"
      pattern: "dialogRef\\.current\\.showModal"
---

<objective>
Create the settings modal shell using native HTML dialog element with proper accessibility and close behaviors.

Purpose: Provide the container for city selection UI. Native dialog handles focus trap, Esc key, and backdrop automatically with better accessibility than custom modals.
Output: Reusable SettingsModal component with open/close state sync, backdrop click handler, X button
</objective>

<execution_context>
@/home/ntorrent/.claude/get-shit-done/workflows/execute-plan.md
@/home/ntorrent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/08-city-configuration/08-RESEARCH.md

# Existing component patterns
@src/components/Header.tsx
@src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SettingsModal component</name>
  <files>src/components/SettingsModal.tsx</files>
  <action>
Create SettingsModal component following the dialog pattern from RESEARCH.md:

Props interface:
- isOpen: boolean (controls modal visibility)
- onClose: () => void (callback when modal should close)
- children: React.ReactNode (modal content)

Implementation:
1. Use useRef<HTMLDialogElement> to reference dialog
2. useEffect syncs React state with dialog element:
   - When isOpen && !dialog.open -> dialog.showModal()
   - When !isOpen && dialog.open -> dialog.close()
3. Listen to dialog's onClose event to sync back to React state (handles Esc key)
4. Handle backdrop click: check if event.target === dialogRef.current, then call onClose()
5. Render X close button inside modal-content div

Structure:
```tsx
<dialog ref={dialogRef} onClose={onClose} onClick={handleBackdropClick} className="settings-modal">
  <div className="modal-content">
    <button onClick={onClose} className="modal-close-btn" aria-label="Close settings">X</button>
    {children}
  </div>
</dialog>
```

IMPORTANT pitfall from RESEARCH.md: Native dialog doesn't close on backdrop click by default. Must add onClick handler that checks event.target === dialogRef.current.
  </action>
  <verify>Import component in App.tsx temporarily, trigger open/close, verify Esc key and backdrop click work</verify>
  <done>SettingsModal exported, opens/closes correctly, handles Esc key and backdrop click</done>
</task>

<task type="auto">
  <name>Task 2: Add modal CSS styles</name>
  <files>src/App.css</files>
  <action>
Add CSS for settings modal to App.css. Match existing app design language (minimal, clean).

Required styles:

1. .settings-modal (the dialog element):
   - border: none (remove default dialog border)
   - border-radius: 8px
   - padding: 0
   - max-width: 400px
   - width: 90%
   - box-shadow for depth

2. .settings-modal::backdrop:
   - background: rgba(0, 0, 0, 0.5)

3. .modal-content:
   - padding: 1.5rem
   - position: relative (for close button positioning)

4. .modal-close-btn:
   - position: absolute
   - top: 0.5rem
   - right: 0.5rem
   - background: transparent
   - border: none
   - font-size: 1.25rem
   - cursor: pointer
   - padding: 0.25rem 0.5rem
   - color: inherit
   - opacity: 0.6
   - hover: opacity: 1

5. Modal header styling (.modal-header h2):
   - margin: 0 0 1rem 0
   - font-size: 1.25rem

Follow existing App.css patterns for colors and spacing.
  </action>
  <verify>Open modal in browser, visually confirm backdrop overlay, centered modal, X button positioning</verify>
  <done>Modal styled with backdrop overlay, centered position, accessible close button</done>
</task>

</tasks>

<verification>
1. Modal opens when isOpen=true
2. Modal closes when clicking X button
3. Modal closes when clicking backdrop (outside modal content)
4. Esc key closes modal
5. Focus is trapped inside modal when open
6. Styling matches app design (minimal, clean)
</verification>

<success_criteria>
- SettingsModal component can be imported and used with any children content
- All three close methods work (X button, backdrop click, Esc key)
- Modal is accessible (native dialog provides focus trap, aria)
- No external modal library dependencies
</success_criteria>

<output>
After completion, create `.planning/phases/08-city-configuration/08-02-SUMMARY.md`
</output>
